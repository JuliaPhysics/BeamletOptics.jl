<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Miniature microscope · BeamletOptics.jl</title><meta name="title" content="Miniature microscope · BeamletOptics.jl"/><meta property="og:title" content="Miniature microscope · BeamletOptics.jl"/><meta property="twitter:title" content="Miniature microscope · BeamletOptics.jl"/><meta name="description" content="Documentation for BeamletOptics.jl."/><meta property="og:description" content="Documentation for BeamletOptics.jl."/><meta property="twitter:description" content="Documentation for BeamletOptics.jl."/><meta property="og:url" content="https://StackEnjoyer.github.io/BeamletOptics.jl/tutorials/microscope/"/><meta property="twitter:url" content="https://StackEnjoyer.github.io/BeamletOptics.jl/tutorials/microscope/"/><link rel="canonical" href="https://StackEnjoyer.github.io/BeamletOptics.jl/tutorials/microscope/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="BeamletOptics.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="BeamletOptics.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../expander/">Beam expander</a></li><li class="is-active"><a class="tocitem" href>Miniature microscope</a><ul class="internal"><li><a class="tocitem" href="#How-to-follow-this-tutorial"><span>How to follow this tutorial</span></a></li><li><a class="tocitem" href="#Miniscope-objective-lenses"><span>Miniscope objective lenses</span></a></li><li><a class="tocitem" href="#The-filter-and-collection-group"><span>The filter and collection group</span></a></li><li><a class="tocitem" href="#Geometrical-ray-tracing-of-the-miniscope"><span>Geometrical ray tracing of the miniscope</span></a></li></ul></li><li><a class="tocitem" href="../michelson/">Michelson interferometer</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/spherical_lenses/">Spherical lenses</a></li><li><a class="tocitem" href="../../examples/aspherical_lenses/">Aspherical lenses</a></li><li><a class="tocitem" href="../../examples/double_gauss/">Double Gauss lens</a></li><li><a class="tocitem" href="../../examples/lens_groups/">Lens groups</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/intro/">Introduction</a></li><li><a class="tocitem" href="../../basics/rays/">Rays</a></li><li><a class="tocitem" href="../../basics/beams/">Beams</a></li><li><a class="tocitem" href="../../basics/elements/">Optical elements</a></li><li><a class="tocitem" href="../../basics/systems/">Optical systems</a></li><li><a class="tocitem" href="../../basics/render/">Visualization</a></li></ul></li><li><span class="tocitem">Components</span><ul><li><a class="tocitem" href="../../components/components/">Overview</a></li><li><a class="tocitem" href="../../components/mirrors/">Mirrors</a></li><li><a class="tocitem" href="../../components/lenses/">Lenses</a></li><li><a class="tocitem" href="../../components/beamsplitters/">Beamsplitters</a></li><li><a class="tocitem" href="../../components/detectors/">Detectors</a></li></ul></li><li><span class="tocitem">Developer Documentation</span><ul><li><a class="tocitem" href="../../guide/">Dev. guide</a></li><li><a class="tocitem" href="../../design/">API design</a></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Miniature microscope</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Miniature microscope</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/StackEnjoyer/BeamletOptics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/StackEnjoyer/BeamletOptics.jl/blob/master/docs/src/tutorials/microscope.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Miniature-microscope"><a class="docs-heading-anchor" href="#Miniature-microscope">Miniature microscope</a><a id="Miniature-microscope-1"></a><a class="docs-heading-anchor-permalink" href="#Miniature-microscope" title="Permalink"></a></h1><p>The UCLA Miniscope is a lightweight microscope that utilizes 2-photon fluorescence imaging to record neural activity in awake, freely moving mice [<a href="../../reference/#Madruga:2024">1</a>]. This beginner tutorial aims to reproduce the optical path of the imaging system from the data provided in the <a href="https://github.com/golshanilab/UCLA_2P_Miniscope">UCLA 2P Miniscope repository</a>. You will learn how to:</p><ol><li>Define optical components (e.g. a <a href="../../components/lenses/#BeamletOptics.SphericalDoubletLens-NTuple{8, Any}-components-lenses"><code>SphericalDoubletLens</code></a>)</li><li>Position the mentioned components using the kinematic API</li><li>Define an optical <a href="../../reference/#BeamletOptics.System"><code>System</code></a></li><li>Add a source of <a href="../../reference/#BeamletOptics.Ray"><code>Ray</code></a>s </li><li>Trace a <a href="../../reference/#BeamletOptics.Beam"><code>Beam</code></a> through the optical system</li><li>Visualize the results </li></ol><p>All specifications for the optical system and CAD files are taken from the UCLA miniscope <a href="https://github.com/golshanilab/UCLA_2P_Miniscope">repository</a> under GNU GPL-3.0.</p><p><img src="../ucla_intro_fig.png" alt="UCLA miniscope introduction figure"/></p><h2 id="How-to-follow-this-tutorial"><a class="docs-heading-anchor" href="#How-to-follow-this-tutorial">How to follow this tutorial</a><a id="How-to-follow-this-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-follow-this-tutorial" title="Permalink"></a></h2><p>All figures you will see below are pregenerated. The full code and all 3D assets are available in the following files:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">┌ Info: </span></span>Files located at:
<span class="sgr36"><span class="sgr1">└ </span></span>  path = &quot;/home/runner/work/BeamletOptics.jl/BeamletOptics.jl/docs/build/assets/ms_assets&quot;</code></pre><p>If you want to reproduce the plots in this tutorial by yourself, it is recommend that you use the <code>render!</code> function as described in the <a href="../../basics/render/#Visualization">Visualization</a> section. In addition, your simulation script to follow this tutorial should include the following setup code at the start of the file:</p><pre><code class="language-julia hljs">using GLMakie, BeamletOptics

const BMO = BeamletOptics

const cm = 1e-2
const mm = 1e-3</code></pre><h2 id="Miniscope-objective-lenses"><a class="docs-heading-anchor" href="#Miniscope-objective-lenses">Miniscope objective lenses</a><a id="Miniscope-objective-lenses-1"></a><a class="docs-heading-anchor-permalink" href="#Miniscope-objective-lenses" title="Permalink"></a></h2><p>This tutorial will focus on modeling the return path of the fluorescence light. Based on the design files provided in the resources above, we will start by defining the first lens along the optical path. This plano-convex lens can be generated via three approaches:</p><ol><li>Design a <a href="../../reference/#BeamletOptics.AbstractShape"><code>BeamletOptics.AbstractShape</code></a> and pass it into the <a href="../../reference/#BeamletOptics.Lens"><code>Lens</code></a> type</li><li>Use the <a href="../../components/lenses/#BeamletOptics.SphericalLens-components-lenses"><code>SphericalLens</code></a> convenience constructor</li><li>Utilize the quasi surface-based <a href="../../reference/#BeamletOptics.Lens"><code>Lens</code></a> constructor</li></ol><p>Due to its versatility, we will use the latter method in order to reimplement the Zemax design file. It is based on the definition of surface types which will be translated into the correct <code>AbstractShape</code> automatically. Refer to the <a href="../../components/lenses/#Surface-based-lens-construction">Surface based lens construction</a> section for more information.</p><h3 id="Defining-refractive-index-data"><a class="docs-heading-anchor" href="#Defining-refractive-index-data">Defining refractive index data</a><a id="Defining-refractive-index-data-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-refractive-index-data" title="Permalink"></a></h3><p>Before we can start, we will need to define refractive indices as a function of the wavelength. For the purpose of this tutorial, we will need to consider the refractive index of the relevant glasses at the design wavelengths. Later on we will define geometrical beams with discrete wavelengths for the ray tracing solver. For the purpose of fluorescence imaging, we will look at <span>$\lambda_{green} = 546.1~\mathrm{nm}$</span> and <span>$\lambda_{red} = 656.3~\mathrm{nm}$</span>. The indices have been manually taken from the <a href="https://www.schott.com/shop/advanced-optics/en/Optical-Glass/c/optical-glass">Schott glass catalog</a>.</p><pre><code class="language-julia hljs"># Define the design wavelengths
λ_green = 546.1e-9
λ_red   = 656.3e-9
lambdas = [λ_green, λ_red]
# Define ref. indices at the specified wavelengths
NBK7    = DiscreteRefractiveIndex(lambdas, [1.51872, 1.51432])
NSK5    = DiscreteRefractiveIndex(lambdas, [1.59142, 1.58619])
NSF4    = DiscreteRefractiveIndex(lambdas, [1.76164, 1.74719])
NLAK22  = DiscreteRefractiveIndex(lambdas, [1.65391, 1.64760])
NLASF44 = DiscreteRefractiveIndex(lambdas, [1.80832, 1.79901])</code></pre><p>Note that the data for (<span>$\lambda_{1}$</span>, <span>$\lambda_{2}$</span>) is mapped onto (<span>$n_{1}$</span>, <span>$n_{2}$</span>). For more information, refer to the <a href="../../reference/#BeamletOptics.DiscreteRefractiveIndex"><code>DiscreteRefractiveIndex</code></a> docs.</p><h3 id="Specifying-the-lens-shape"><a class="docs-heading-anchor" href="#Specifying-the-lens-shape">Specifying the lens shape</a><a id="Specifying-the-lens-shape-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-the-lens-shape" title="Permalink"></a></h3><p>The following code defines the front planar surface and the back spherical convex surface.</p><pre><code class="language-julia hljs"># Objective lens 1
surf_1 = CircularFlatSurface(2*1.144mm)
surf_2 = SphericalSurface(-1.448mm, 2*1.144mm)
obj_lens_1 = Lens(surf_1, surf_2, 1.3mm, NSK5)</code></pre><p>Note that <code>obj_lens_1</code> is a single <code>Lens</code> entity once spawned and can be manipulated in 3D-space as described in the section: <a href="../../basics/elements/#Moving-optical-elements">Moving optical elements</a>.</p><p><img src="../objective_lens_1.png" alt="First objective lens"/></p><h3 id="Building-the-objective-group"><a class="docs-heading-anchor" href="#Building-the-objective-group">Building the objective group</a><a id="Building-the-objective-group-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-objective-group" title="Permalink"></a></h3><p>To build the second and third lens elements of the objective group we will proceed as above. However, these lenses are spherical doublets formed by two lenses bonded with an optical adhesive in practice. They are also more complex in shape, featuring a mechanical outer diameter. For the second lens the generating code is provided below. Two <a href="../../reference/#BeamletOptics.Lens"><code>Lens</code></a>es can be combined into a <a href="../../reference/#BeamletOptics.DoubletLens"><code>DoubletLens</code></a>. Correct &quot;assembly&quot; of the lens parts is the responsibility of the user.</p><pre><code class="language-julia hljs"># Objective lens 2 - define surfaces
surf_1 = SphericalSurface(38.184mm, 2*1.840mm, 2*2.380mm)
surf_2 = SphericalSurface(3.467mm, 2*2.060mm, 2*2.380mm)
surf_3 = SphericalSurface(-5.020mm, 2*2.380mm)
# Define front and back lens
dl11 = Lens(surf_1, surf_2, 0.5mm, NSF4)
dl12 = Lens(surf_2, surf_3, 2.5mm, NLAK22)
# Move back lens into position
translate3d!(dl12, [0, thickness(dl11), 0])
# Spawn doublet
obj_lens_2 = DoubletLens(dl11, dl12)</code></pre><p>The lens parts <code>dl11</code> and <code>dl12</code> are joined together by moving <code>dl12</code> along the y-axis by a distance equal to the on-axis <a href="../../reference/#BeamletOptics.thickness-Tuple{BeamletOptics.AbstractLensSDF}"><code>thickness</code></a> of <code>dl11</code>.</p><p><img src="../objective_lens_2.png" alt="Second objective lens"/></p><div class="admonition is-info" id="Axis-conventions-7adefd6c86af4446"><header class="admonition-header">Axis conventions<a class="admonition-anchor" href="#Axis-conventions-7adefd6c86af4446" title="Permalink"></a></header><div class="admonition-body"><p>In general, most components provided by <strong>BMO</strong> are aligned with the global y-axis and spawned at the origin unless specified otherwise.</p></div></div><p>Similarily, the third objective lens can be reproduced from the available Zemax data as follows:</p><pre><code class="language-julia hljs"># Tube lens
surf_1 = SphericalSurface(7.744mm, 2*2.812mm, 2*3mm)
surf_2 = SphericalSurface(-3.642mm, 2*3mm)
surf_3 = SphericalSurface(-14.413mm, 2*2.812mm, 2*3mm)
dl21 = Lens(surf_1, surf_2, 3.4mm, NLAK22)
dl22 = Lens(surf_2, surf_3, 1.0mm, NSF4)
translate3d!(dl22, [0, thickness(dl21), 0])
tube_lens = DoubletLens(dl21, dl22)</code></pre><p>Assembling the objective group requires that the individual lens elements be translated into position along the optical axis. This is achieved in the code below by taking the current <a href="../../reference/#Base.position-Tuple{BeamletOptics.AbstractObject}"><code>position</code></a> of the elements and adding the on-axis <code>thickness</code> in addition to the element distancing taken from the specification.</p><pre><code class="language-julia hljs">translate_to3d!(obj_lens_2, [0, position(obj_lens_1)[2] + thickness(obj_lens_1) + 3.344mm, 0])
translate_to3d!(tube_lens, [0, position(obj_lens_2)[2] + thickness(obj_lens_2) + 2mm, 0])
obj_group = ObjectGroup([obj_lens_1, obj_lens_2, tube_lens])</code></pre><p>The <a href="../../reference/#BeamletOptics.ObjectGroup"><code>ObjectGroup</code></a> locks all elements in place with respect to their relative positions and allows for combined translations and rotations of the elements.</p><h3 id="Visualizing-the-lenses"><a class="docs-heading-anchor" href="#Visualizing-the-lenses">Visualizing the lenses</a><a id="Visualizing-the-lenses-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-the-lenses" title="Permalink"></a></h3><p>In order to visualize what we have done so far, we will use <code>GLMakie</code> to create a 3D plot of the <code>BMO</code> geometry representation. The following code will be used.</p><pre><code class="language-julia hljs"># define rgba for lens look
lens_color() = RGBf(0.678, 0.847, 0.902)
lens_color(alpha) = RGBAf(0.678, 0.847, 0.902, alpha)

# generate figure
fig = Figure()
ax = LScene(fig[1,1])
render!(ax, obj_lens_1, transparency=true, color=lens_color(0.5))
render!(ax, obj_lens_2, transparency=true, color=lens_color(0.5))
render!(ax, tube_lens, transparency=true, color=lens_color(0.5))</code></pre><p>The generated figure can be seen below. A dashdot line has been added to indicate the global y-axis and lens labels are shown for easier viewing.</p><p><img src="../full_objective_lens.png" alt="Miniscope objective lenses"/></p><h2 id="The-filter-and-collection-group"><a class="docs-heading-anchor" href="#The-filter-and-collection-group">The filter and collection group</a><a id="The-filter-and-collection-group-1"></a><a class="docs-heading-anchor-permalink" href="#The-filter-and-collection-group" title="Permalink"></a></h2><p>The miniscope features a dichroic beamsplitter to seperate the emission path from the imaging optics. For the imaging path, the beamsplitter is followed by two filters and a collection lens. For the purpose of this tutorial, we will model the beamsplitter and filters as simple glass plates, i.e. <a href="../../reference/#BeamletOptics.Prism"><code>Prism</code></a>s. However, for an accurate representation, we will first have to move the lens group into position. This involves a rotation around the x-axis by 90°. We can achieve this simply with the following command. Note that the pivot point lies at the origin.</p><pre><code class="language-julia hljs">xrotate3d!(obj_group, deg2rad(90))</code></pre><h3 id="Modeling-the-dichroic-filter"><a class="docs-heading-anchor" href="#Modeling-the-dichroic-filter">Modeling the dichroic filter</a><a id="Modeling-the-dichroic-filter-1"></a><a class="docs-heading-anchor-permalink" href="#Modeling-the-dichroic-filter" title="Permalink"></a></h3><p>Spawning the &quot;filter&quot; works as detailled above. Using a <a href="../../reference/#BeamletOptics.Prism"><code>Prism</code></a> to represent the dispersive properties of the substrate glass is functionally equal to using a <code>Lens</code> and serves simply to indicate that this element is not for imaging purposes. Use the following snippet to create the element. Note that the element is moved to its global absolute position. This data is taken from the CAD model provided in the repository.</p><pre><code class="language-julia hljs">## Dichroic &quot;splitter&quot; - glass plate
shape = BMO.CuboidMesh(8mm, 1mm, 8.5mm)
translate3d!(shape, [-4mm, 0.0mm, -4.25mm])
BMO.set_new_origin3d!(shape)
splitter = Prism(shape, NBK7)
# Move to global position from origin
translate3d!(splitter, [0, 0, 18.677mm])
xrotate3d!(splitter, deg2rad(45))</code></pre><h3 id="Modeling-the-collection-group"><a class="docs-heading-anchor" href="#Modeling-the-collection-group">Modeling the collection group</a><a id="Modeling-the-collection-group-1"></a><a class="docs-heading-anchor-permalink" href="#Modeling-the-collection-group" title="Permalink"></a></h3><p>For the collection group filters we use the same approach as above. The collection lens parameters are derived from the Zemax file and the parametrization works analogously as in the section: <a href="#Building-the-objective-group">Building the objective group</a></p><pre><code class="language-julia hljs">ef_1 = Prism(BMO.PlanoSurfaceSDF(1mm, 4mm), NBK7)
ef_2 = Prism(BMO.PlanoSurfaceSDF(1mm, 4mm), NBK7)

collect_lens = Lens(
    SphericalSurface(6.580mm, 4.5mm),
    SphericalSurface(-6.580mm, 4.5mm),
    2.6mm,
    NLASF44
)

translate3d!(collect_lens, [0, position(ef_1)[2] + thickness(ef_1) + 0.1mm, 0])
translate3d!(ef_2, [0, position(collect_lens)[2] + thickness(collect_lens) + 0.25mm, 0])

collect_group = ObjectGroup([ef_1, collect_lens, ef_2])

# Move to global position from origin
xrotate3d!(collect_group, deg2rad(90))
translate3d!(collect_group, [0, 0.332mm, 21.937mm])</code></pre><p>Finally, we can define a <a href="../../reference/#BeamletOptics.System"><code>System</code></a> that stores all optical elements for the following ray tracing procedure. </p><pre><code class="language-julia hljs">system = System([obj_group, filter, collect_group])</code></pre><p>Elements can still be moved mutably while being inside the <code>system</code> and their final position is considered when running the <a href="../../basics/systems/#BeamletOptics.solve_system!-basics-systems"><code>solve_system!</code></a> command. Visualizing the system can be easily achieved via <code>render!(ax, system; # kwargs go here)</code>. The full optical system is shown below.</p><p><img src="../full_optical_system.png" alt="Full miniscope optical system"/></p><h2 id="Geometrical-ray-tracing-of-the-miniscope"><a class="docs-heading-anchor" href="#Geometrical-ray-tracing-of-the-miniscope">Geometrical ray tracing of the miniscope</a><a id="Geometrical-ray-tracing-of-the-miniscope-1"></a><a class="docs-heading-anchor-permalink" href="#Geometrical-ray-tracing-of-the-miniscope" title="Permalink"></a></h2><p>Finally we are ready to perform the ray tracing step. This requires us to have a defined <code>system</code> and one or more <code>beam</code>s for the <code>solve_system!(system, beam)</code> function. For more information on this topic, refer to the section: <a href="../../basics/systems/#Tracing-systems">Tracing systems</a>. </p><p>This package provides the convenience <a href="../../reference/#BeamletOptics.PointSource"><code>PointSource</code></a> which will allows us to model a spread fan of light rays easily. We will define two monochromatic sources for the wavelengths specified above:</p><pre><code class="language-julia hljs">ps_green = PointSource([0, 0, -0.5mm], [0, 0, 1], deg2rad(20), λ_green, num_rays=1000, num_rings=5)
ps_red =   PointSource([0, 0, -0.5mm], [0, 0, 1], deg2rad(30), λ_red,   num_rays=1000, num_rings=5)</code></pre><p>The sources for <span>$\lambda_{546.1~\mathrm{nm}}$</span> and <span>$\lambda_{656.3~\mathrm{nm}}$</span> are initialized 0.5mm below the first optical surface of the imaging system with half-spread-angles of 20° and 30°, respectively. It is important to note that this value was chosen in order to roughly match the illustrated optical path in the miniscope publication [<a href="../../reference/#Madruga:2024">1</a>, Fig. 1]. Feel free to play around the initialization values and observe how they influence the result of the optical path. Further, each source is initialized with a total of 1000 rays layered in 5 rings, where the first &quot;ring&quot; is a single beam along the optical axis.</p><p>In order to calculate the optical path, simply run the following command:</p><pre><code class="language-julia hljs">solve_system!(system, ps_green)
solve_system!(system, ps_red)</code></pre><p>The results can be visualized with the following script:</p><pre><code class="language-julia hljs">fig = Figure()
ax = LScene(fig[1,1])

render!(ax, system)
render!(ax, ps_green; color=RGBAf(0,1,0,1.00), render_every=5, flen=3mm, show_pos=false)
render!(ax, ps_red;   color=RGBAf(1,0,0,0.25), render_every=5, flen=3mm, show_pos=false)</code></pre><p>For the plotting of the <code>PointSource</code> we will use the <code>render_every</code> keyword argument in order to only display every fifth beam. The <code>flen</code> keyword limits the length of the final, non-intersecting ray to 3mm after its last interaction. Below, the resulting figure is displayed (rotated by 90°):</p><p><img src="../miniscope_trace.png" alt="Miniscope optical path"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../expander/">« Beam expander</a><a class="docs-footer-nextpage" href="../michelson/">Michelson interferometer »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Friday 13 June 2025 11:13">Friday 13 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
